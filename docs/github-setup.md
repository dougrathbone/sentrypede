# GitHub Integration Setup Guide

This guide will help you set up GitHub integration for Sentrypede, allowing it to automatically create branches, commit fixes, and open pull requests.

## Prerequisites

- A GitHub account
- A repository where Sentrypede will create pull requests
- Appropriate permissions to create branches and pull requests

## Step 1: Create a Personal Access Token

1. Go to GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)
2. Click "Generate new token (classic)"
3. Give your token a descriptive name (e.g., "Sentrypede Bot")
4. Set an expiration (recommended: 90 days, remember to rotate)
5. Select the following scopes:
   - **repo** (Full control of private repositories) - Required for:
     - Creating branches
     - Creating commits
     - Opening pull requests
     - Reading repository content
   - **workflow** (optional) - If you want to trigger GitHub Actions
6. Click "Generate token"
7. **Copy the token immediately** - you won't be able to see it again!

## Step 2: Configure Environment Variables

Add the following to your `.env` file:

```bash
# GitHub Configuration
GITHUB_TOKEN=ghp_your_token_here
GITHUB_OWNER=your-username-or-org
GITHUB_REPO=your-repository-name
GITHUB_DEFAULT_BRANCH=main  # or master, depending on your repo
```

### Configuration Details

- **GITHUB_TOKEN**: The personal access token you created
- **GITHUB_OWNER**: Your GitHub username or organization name
- **GITHUB_REPO**: The repository name (without the owner)
- **GITHUB_DEFAULT_BRANCH**: The default branch name (usually `main` or `master`)

## Step 3: Test the Integration

Run the GitHub integration test to verify everything is configured correctly:

```bash
npm run test:github
```

This will:
1. Verify authentication
2. Check repository access
3. List files in the repository
4. Test branch creation (if permissions allow)

## Step 4: Repository Setup

### Branch Protection (Recommended)

To ensure automated PRs are reviewed before merging:

1. Go to Settings ‚Üí Branches in your repository
2. Add a branch protection rule for your default branch
3. Enable:
   - Require pull request reviews before merging
   - Dismiss stale pull request approvals
   - Require status checks to pass (if you have CI/CD)

### GitHub Actions (Optional)

Create `.github/workflows/sentrypede-pr.yml` to run tests on Sentrypede PRs:

```yaml
name: Sentrypede PR Check

on:
  pull_request:
    branches: [ main ]
    # Only run on Sentrypede-created PRs
    paths:
      - '**.js'
      - '**.ts'
      - '**.jsx'
      - '**.tsx'

jobs:
  test:
    if: startsWith(github.head_ref, 'fix/sentry-issue-')
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: '18'
    - run: npm ci
    - run: npm test
    - run: npm run lint
```

## How It Works

When Sentrypede detects and analyzes a Sentry error:

1. **Branch Creation**: Creates a branch named `fix/sentry-issue-{issueId}`
2. **Code Changes**: Commits the AI-generated fix to the branch
3. **Pull Request**: Opens a PR with:
   - Descriptive title with the error
   - Detailed description linking to the Sentry issue
   - List of changed files
   - Review instructions

## Security Best Practices

1. **Token Rotation**: Rotate your GitHub token every 90 days
2. **Least Privilege**: Only grant the minimum required permissions
3. **Repository Access**: Consider using a dedicated bot account
4. **Branch Protection**: Always require PR reviews for production branches
5. **Audit Logs**: Regularly review GitHub audit logs for bot activity

## Troubleshooting

### Authentication Failed (401)
- Verify your token is correct and hasn't expired
- Ensure the token has the required scopes

### Repository Not Found (404)
- Check GITHUB_OWNER and GITHUB_REPO are correct
- Verify the token has access to the repository

### Permission Denied (403)
- Ensure your token has the `repo` scope
- Check if branch protection rules are blocking creation

### Rate Limiting
- GitHub API has rate limits (5000 requests/hour for authenticated requests)
- Sentrypede implements respectful API usage
- If you hit limits, consider using a GitHub App instead

## Using GitHub Apps (Advanced)

For production deployments, consider using a GitHub App instead of a personal access token:

1. Create a GitHub App in your organization
2. Install it on the target repository
3. Use the app's authentication instead of a PAT

Benefits:
- Higher rate limits
- Better security model
- Granular permissions
- Audit trail

## Example Pull Request

Here's what a Sentrypede-generated PR looks like:

```markdown
## ü§ñ Automated Fix

This pull request was automatically generated by Sentrypede to fix a Sentry issue.

### üìã Issue Details
- **Sentry Issue ID**: ABC123
- **Error**: TypeError: Cannot read property 'name' of undefined

### üìù Changes Made
- `src/components/UserProfile.js`

### üîç Review Instructions
1. Review the changes carefully
2. Ensure the fix addresses the root cause
3. Check that no new issues are introduced
4. Run tests to verify the fix

### ‚ö†Ô∏è Note
This is an automated fix. Please review thoroughly before merging.

---
*Generated by [Sentrypede](https://github.com/sentrypede) üêõü§ñ*
```

## Next Steps

Once GitHub integration is set up:

1. Ensure your Sentry integration is working
2. Configure Slack for notifications
3. Set up Google Gemini for AI analysis
4. Start monitoring and auto-fixing errors!

For more information, see the [main README](../README.md). 